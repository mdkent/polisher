%h4
  Sources

%ul
  - @sources.sort { |x,y| x.name <=> y.name }.each do |source|
    %li
      %h5
      = source.name
      %a{:href => url_for("/sources/destroy/#{source.id}"), :class => 'delete_source_link'}
        (delete)
      %br/
      %h6
        versions
      %ul
        - source.versions.each do |version|
          - sprojects = source.projects_sources_for_version(version)
          %li
            %h7
              = version
            %h8
              projects
            %ul
              - sprojects.each do |ps|
                %h9
                  = ps.project.name
                  = ps.project_version
                  %a{:href => url_for("/projects_sources/destroy/#{ps.id}"), :class => 'delete_project_source_link'}
                    (delete)

%h4
  New Source

%form{:id => 'create_source_form', :method => "post", :action => url_for("/sources/create")}
  %table
    %tr
      %td
        Name:
      %td
        %input{:type => "text", :id => "name", :name => "name"}

    %tr
      %td
        URI:
      %td
        %input{:type => "text", :id => "uri", :name => "uri"}

    %tr
      %td
        %input{:type => "submit", :value => "submit"}

%h4
  New Project Source

%form{:id => 'create_project_source_form', :method => "post", :action => url_for("/projects_sources/create")}
  %table
    %tr
      %td
        Project:
      %td
        %select{:id => "project_id", :name => "project_id"}
          - @projects.each do |project|
            %option{:id => project.id, :value => project.id}
              = project.name
    %tr
      %td
        Source:
      %td
        %select{:id => "source_id", :name => "source_id"}
          - @sources.each do |source|
            %option{:id => source.id, :value => source.id}
              = source.name

    %tr
      %td
        %input{:type => "submit", :value => "submit"}


%script{:type => "text/javascript"}
  :plain
    $('.delete_source_link').bind('click', function(e){
       c = confirm("delete source?")
       if(c){
         delete_request(this.href, function(result) { handle_request_result(result); });
       }
       return false;
    });
    $('.delete_project_source_link').bind('click', function(e){
       c = confirm("delete project source?")
       if(c){
         delete_request(this.href, function(result) { handle_request_result(result); });
       }
       return false;
    });
    $('#create_source_form').submit(function(e){
      post_request(this.action,
                   ({ name : $('#name').val(), uri : $('#uri').val()}),
                   function(result) { handle_request_result(result) });
      return false;
    });
    $('#create_project_source_form').submit(function(e){
      post_request(this.action,
                   ({ project_id : $('#project_id').val(), uri : $('#uri').val()}),
                   function(result) { handle_request_result(result) });
      return false;
    });
